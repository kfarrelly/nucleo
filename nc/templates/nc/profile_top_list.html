{% extends "nc/base.html" %}
{% load static %}
{% load bootstrap %}
{% load humanize %}
{% load nc_extras %}

{% block head %}{% endblock %}

{% block nc_style %}
<link rel="stylesheet" type="text/css" href='{% static 'nc/leaderboard.css' %}' />
{% endblock %}

{% block title %}Nucleo | Top Users{% endblock %}

{% block nav %}
<div class="sidebar-sticky">
  <ul class="nav flex-column">
    <li class="nav-item">
      <a class="nav-link" href="{% url 'nc:feed-redirect' %}">
        <span data-feather="activity"></span>
        Feed
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="{% url 'nc:user-redirect' %}">
        <span data-feather="user"></span>
        Profile
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link active" href="{% url 'nc:leaderboard-redirect' %}">
        <span data-feather="award"></span>
        Leaderboard <span class="sr-only">(current)</span>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="{% url 'nc:send-redirect' %}">
        <span data-feather="send"></span>
        Send
      </a>
    </li>
  </ul>
</div>
{% endblock %}

{% block main %}
<nav class="nav nav-leaderboard nav-pills nav-justified p-4" role="tablist">
  <a href="" class="nav-item nav-link active d-flex flex-column justify-content-center align-items-center">
    <span data-feather="award"></span>
    Users
  </a>
  <a href="{% url 'nc:top-asset-list' %}" class="nav-item nav-link d-flex flex-column justify-content-center align-items-center">
    <span data-feather="star"></span>
    Assets
  </a>
</nav>

<div class="card p-3 p-md-5 bg-white rounded box-shadow">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5>Top Performers</h5>
    <div class="btn-group" role="group">
      {% for d in allowed_date_orderings %}
      <a href="{% url 'nc:top-user-list' %}?span={{ d }}" {% if date_span == d %}class="btn btn-sm btn-outline-secondary active"{% else %}class="btn btn-sm btn-outline-secondary"{% endif %}>{{ d }}</a>
      {% endfor %}
    </div>
  </div>
  <ol class="list-group">
    {% for u in page_obj %}
    <a href="{% url 'nc:user-detail' u.username %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
      <div class="d-inline-flex justify-content-start align-items-center">
        <span class="badge badge-white mr-2">{{ forloop.counter0|add:page_top_number }}</span>
        <img class="img-object-fit-cover img-thumbnail rounded flex-auto" style="height: 50px; width: 50px;"{% if u.profile.pic %} src="{{ u.profile.pic.url }}"{% endif %} alt="">
        <div class="ml-2 d-flex flex-column align-items-start justify-content-center">
          <strong>{{ u.get_full_name }}</strong>
          <small class="text-muted">@{{ u.username }}</small>
        </div>
      </div>
      {% with u.profile.portfolio|get_attribute:performance_attr as peformance %}
      {% if performance %}
      <div class="btn-group py-1">
        <button type="button" title="Performance" {% if performance > 0 %}class="btn btn-sm btn-success"{% elif performance < 0 %}class="btn btn-sm btn-danger"{% else %}class="btn btn-sm btn-secondary"{% endif %}>
          {% if performance > 0 %}+{% endif %}{{ performance|percentage }}
        </button>
      </div>
      {% endif %}
      {% endwith %}
    </a>
    {% endfor %}
  </ol>
</div>

<div class="pagination mt-2">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; First</a>
            <a href="?page={{ page_obj.previous_page_number }}">Previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">Next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">Last &raquo;</a>
        {% endif %}
    </span>
</div>
{% endblock %}


{% block nc_script %}
{% endblock %}
